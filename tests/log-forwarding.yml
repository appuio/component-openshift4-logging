applications:
  - openshift4-operators as openshift-operators-redhat
  - openshift4-monitoring

parameters:
  kapitan:
    dependencies:
      - type: https
        source: https://raw.githubusercontent.com/appuio/component-openshift4-operators/v1.0.2/lib/openshift4-operators.libsonnet
        output_path: vendor/lib/openshift4-operators.libsonnet
      - type: https
        source: https://raw.githubusercontent.com/appuio/component-openshift4-monitoring/v2.9.0/lib/openshift4-monitoring-alert-patching.libsonnet
        output_path: vendor/lib/alert-patching.libsonnet
    compile:
      - input_type: jsonnet
        input_paths:
          - tests/console-patch.jsonnet
        output_path: console-patching/

  openshift4_operators:
    defaultInstallPlanApproval: Automatic
    defaultSource: openshift-operators-redhat
    defaultSourceNamespace: openshift-operators-redhat

  openshift4_logging:
    clusterLogForwarder:
      inputs:
        keycloak-logs:
          application:
            namespaces:
              - vshn-keycloak-prod
      outputs:
        appuio-loki-keycloak:
          type: loki
          url: https://my-loki-url.com
          loki:
            tenantKey: "keycloak"
      filters:
        keycloak-filter:
          type: drop
          drop:
            - test:
                - field: .message
                  notMatches: '.*org\.keycloak\.events.*'
      pipelines:
        keycloak-logs:
          inputRefs:
            - keycloak-logs
          filterRefs:
            - keycloak-filter
          outputRefs:
            - appuio-loki-keycloak
            - default
