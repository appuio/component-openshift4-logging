applications:
  - openshift4-operators as openshift-operators-redhat
  - openshift4-monitoring

parameters:
  kapitan:
    dependencies:
      - type: https
        source: https://raw.githubusercontent.com/projectsyn/component-espejote/master/lib/espejote.libsonnet
        output_path: vendor/lib/espejote.libsonnet
      - type: https
        source: https://raw.githubusercontent.com/appuio/component-openshift4-operators/v1.0.2/lib/openshift4-operators.libsonnet
        output_path: vendor/lib/openshift4-operators.libsonnet
      - type: https
        source: https://raw.githubusercontent.com/appuio/component-openshift4-monitoring/v2.9.0/lib/openshift4-monitoring-alert-patching.libsonnet
        output_path: vendor/lib/alert-patching.libsonnet
      - type: https
        source: https://raw.githubusercontent.com/appuio/component-openshift4-monitoring/master/lib/openshift4-monitoring-operator-rules.libsonnet
        output_path: vendor/lib/operator-rules.libsonnet
    compile:
      - input_type: jsonnet
        input_paths:
          - tests/console-patch.jsonnet
        output_path: console-patching/

  espejote:
    namespace: syn-espejote

  openshift4_operators:
    defaultInstallPlanApproval: Automatic
    defaultSource: openshift-operators-redhat
    defaultSourceNamespace: openshift-operators-redhat

  openshift4_logging:
    channel: 'stable'

    components:
      lokistack:
        internalAppLogsEnabled: false

    clusterLogForwarder:
      filters:
        my-filter:
          openshiftLabels:
            cluster_id: ${cluster:name}
        null-filter: null
      inputs:
        my-apps:
          application:
            namespaces:
              - app-one
              - app-two
        null-input: null
      outputs:
        custom-forwarder:
          type: syslog
        null-output: null
      pipelines:
        application-logs:
          outputRefs:
            - custom-forwarder
        my-apps:
          parse: json
          inputRefs:
            - my-apps
          outputRefs:
            - custom-forwarder
        audit-logs:
          outputRefs:
            - custom-forwarder
        null-pipeline: null

    alerts:
      release: 'master'

    secrets:
      my-secret:
        stringData:
          secret-key: '?{vaultkv:${cluster:tenant}/${cluster:name}/secret-value}'
    configMaps:
      my-configmap:
        data:
          ca.crt: |
            -----BEGIN CERTIFICATE-----
            ...
            -----END CERTIFICATE-----

    workaround:
      missing_metrics_token:
        enabled: false
